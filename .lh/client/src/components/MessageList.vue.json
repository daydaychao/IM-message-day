{
    "sourceFile": "client/src/components/MessageList.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1763717619979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763717632077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -263,5 +263,5 @@\n     hour: \"2-digit\",\n     minute: \"2-digit\",\n   });\n }\n-</script\n\\ No newline at end of file\n+</script>\n"
                },
                {
                    "date": 1763717692679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,267 @@\n+<template>\n+  <div class=\"flex-1 flex flex-col bg-gray-50\">\n+    <!-- Chat Header -->\n+    <div v-if=\"currentConv\" class=\"p-4 bg-white border-b border-gray-300\">\n+      <h3 class=\"text-lg font-bold text-gray-800\">{{ currentConv.name }}</h3>\n+      <p v-if=\"currentConv.type === 'group'\" class=\"text-sm text-gray-600\">\n+        {{ currentConv.members?.length }} ä½æˆå“¡\n+      </p>\n+    </div>\n+\n+    <!-- Messages -->\n+    <div ref=\"messageContainer\" class=\"flex-1 overflow-y-auto p-4 space-y-4\">\n+      <div v-if=\"!currentConv\" class=\"flex items-center justify-center h-full\">\n+        <p class=\"text-gray-500\">é¸æ“‡å°è©±é–‹å§‹èŠå¤©</p>\n+      </div>\n+\n+      <div v-else>\n+        <div\n+          v-for=\"message in chatStore.currentMessages\"\n+          :key=\"message.id\"\n+          :class=\"[\n+            'flex',\n+            message.senderId === authStore.userId\n+              ? 'justify-end'\n+              : 'justify-start',\n+          ]\"\n+        >\n+          <div\n+            :class=\"[\n+              'max-w-md',\n+              message.senderId === authStore.userId\n+                ? 'items-end'\n+                : 'items-start',\n+            ]\"\n+          >\n+            <!-- Sender name for group chats -->\n+            <p\n+              v-if=\"\n+                currentConv.type === 'group' &&\n+                message.senderId !== authStore.userId\n+              \"\n+              class=\"text-xs text-gray-500 mb-1 px-2\"\n+            >\n+              {{ message.senderName }}\n+            </p>\n+\n+            <!-- Message bubble -->\n+            <div\n+              :class=\"[\n+                'rounded-lg px-4 py-2 break-words',\n+                message.senderId === authStore.userId\n+                  ? 'bg-teal-600 text-white'\n+                  : 'bg-white text-gray-800 border border-gray-300',\n+              ]\"\n+            >\n+              <!-- Image message -->\n+              <img\n+                v-if=\"message.type === 'image'\"\n+                :src=\"message.content\"\n+                alt=\"Image\"\n+                class=\"max-w-xs rounded\"\n+              />\n+              <!-- Text message -->\n+              <p v-else>{{ message.content }}</p>\n+            </div>\n+\n+            <!-- Message info -->\n+            <div\n+              :class=\"[\n+                'flex items-center space-x-2 mt-1 text-xs text-gray-500',\n+                message.senderId === authStore.userId\n+                  ? 'justify-end'\n+                  : 'justify-start',\n+              ]\"\n+            >\n+              <span>{{ formatTime(message.timestamp) }}</span>\n+              <span v-if=\"message.senderId === authStore.userId\">\n+                <span v-if=\"message.status === 'sent'\">âœ“</span>\n+                <span v-else-if=\"message.status === 'delivered'\">âœ“âœ“</span>\n+                <span\n+                  v-else-if=\"message.status === 'read'\"\n+                  class=\"text-teal-600\"\n+                  >âœ“âœ“</span\n+                >\n+              </span>\n+            </div>\n+          </div>\n+        </div>\n+\n+        <!-- Typing indicator -->\n+        <div\n+          v-if=\"chatStore.currentTypingUsers.length > 0\"\n+          class=\"flex justify-start\"\n+        >\n+          <div class=\"bg-gray-300 rounded-lg px-4 py-2\">\n+            <div class=\"flex space-x-1\">\n+              <div\n+                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n+              ></div>\n+              <div\n+                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n+                style=\"animation-delay: 0.1s\"\n+              ></div>\n+              <div\n+                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n+                style=\"animation-delay: 0.2s\"\n+              ></div>\n+            </div>\n+          </div>\n+        </div>\n+      </div>\n+    </div>\n+\n+    <!-- Message Input -->\n+    <div v-if=\"currentConv\" class=\"p-4 bg-white border-t border-gray-300\">\n+      <div class=\"flex items-center space-x-2\">\n+        <input\n+          type=\"file\"\n+          ref=\"fileInput\"\n+          accept=\"image/*\"\n+          class=\"hidden\"\n+          @change=\"handleImageSelect\"\n+        />\n+        <button\n+          @click=\"selectImage\"\n+          class=\"p-2 text-gray-600 hover:bg-gray-100 rounded-lg\"\n+          title=\"ä¸Šå‚³åœ–ç‰‡\"\n+        >\n+          ğŸ“\n+        </button>\n+        <input\n+          v-model=\"messageInput\"\n+          @keypress.enter=\"sendMessage\"\n+          @input=\"handleTyping\"\n+          type=\"text\"\n+          placeholder=\"è¼¸å…¥è¨Šæ¯...\"\n+          class=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent\"\n+        />\n+        <button\n+          @click=\"sendMessage\"\n+          class=\"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-semibold\"\n+        >\n+          ç™¼é€\n+        </button>\n+      </div>\n+    </div>\n+  </div>\n+</template>\n+\n+<script setup lang=\"ts\">\n+import { ref, computed, watch, nextTick } from \"vue\";\n+import { useAuthStore } from \"../stores/auth\";\n+import { useChatStore } from \"../stores/chat\";\n+import { useChatSocket } from \"../composables/useChatSocket\";\n+\n+const authStore = useAuthStore();\n+const chatStore = useChatStore();\n+const { sendMessage: socketSendMessage, sendTyping } = useChatSocket();\n+\n+const messageInput = ref(\"\");\n+const fileInput = ref<HTMLInputElement | null>(null);\n+const messageContainer = ref<HTMLElement | null>(null);\n+let typingTimeout: number | null = null;\n+\n+const currentConv = computed(() => {\n+  return chatStore.conversations.find(\n+    (c) => c.id === chatStore.currentConversationId\n+  );\n+});\n+\n+// Auto scroll to bottom when new messages arrive\n+watch(\n+  () => chatStore.currentMessages.length,\n+  async () => {\n+    await nextTick();\n+    if (messageContainer.value) {\n+      messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n+    }\n+  }\n+);\n+\n+// Auto scroll when conversation changes\n+watch(\n+  () => chatStore.currentConversationId,\n+  async () => {\n+    await nextTick();\n+    if (messageContainer.value) {\n+      messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n+    }\n+  }\n+);\n+\n+function sendMessage() {\n+  if (!messageInput.value.trim() || !currentConv.value) return;\n+\n+  const recipientId =\n+    currentConv.value.type === \"dm\" ? currentConv.value.recipientId : undefined;\n+  const groupId =\n+    currentConv.value.type === \"group\" ? currentConv.value.id : undefined;\n+\n+  socketSendMessage(recipientId, groupId, messageInput.value, \"text\");\n+  messageInput.value = \"\";\n+\n+  // Stop typing indicator\n+  sendTyping(recipientId, groupId, false);\n+}\n+\n+function handleTyping() {\n+  if (!currentConv.value) return;\n+\n+  const recipientId =\n+    currentConv.value.type === \"dm\" ? currentConv.value.recipientId : undefined;\n+  const groupId =\n+    currentConv.value.type === \"group\" ? currentConv.value.id : undefined;\n+\n+  // Send typing started\n+  sendTyping(recipientId, groupId, true);\n+\n+  // Clear previous timeout\n+  if (typingTimeout) {\n+    clearTimeout(typingTimeout);\n+  }\n+\n+  // Send typing stopped after 2 seconds of inactivity\n+  typingTimeout = window.setTimeout(() => {\n+    sendTyping(recipientId, groupId, false);\n+  }, 2000);\n+}\n+\n+function selectImage() {\n+  fileInput.value?.click();\n+}\n+\n+function handleImageSelect(event: Event) {\n+  const target = event.target as HTMLInputElement;\n+  const file = target.files?.[0];\n+  if (!file || !currentConv.value) return;\n+\n+  const reader = new FileReader();\n+  reader.onload = (e) => {\n+    const base64 = e.target?.result as string;\n+\n+    const recipientId =\n+      currentConv.value!.type === \"dm\"\n+        ? currentConv.value!.recipientId\n+        : undefined;\n+    const groupId =\n+      currentConv.value!.type === \"group\" ? currentConv.value!.id : undefined;\n+\n+    socketSendMessage(recipientId, groupId, base64, \"image\");\n+  };\n+  reader.readAsDataURL(file);\n+\n+  // Reset file input\n+  if (fileInput.value) {\n+    fileInput.value.value = \"\";\n+  }\n+}\n+\n+function formatTime(timestamp: number): string {\n+  const date = new Date(timestamp);\n+  return date.toLocaleTimeString(\"zh-TW\", {\n+    hour: \"2-digit\",\n+    minute: \"2-digit\",\n+  });\n+}\n+</script>\n"
                }
            ],
            "date": 1763717619979,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"flex-1 flex flex-col bg-gray-50\">\n    <!-- Chat Header -->\n    <div v-if=\"currentConv\" class=\"p-4 bg-white border-b border-gray-300\">\n      <h3 class=\"text-lg font-bold text-gray-800\">{{ currentConv.name }}</h3>\n      <p v-if=\"currentConv.type === 'group'\" class=\"text-sm text-gray-600\">\n        {{ currentConv.members?.length }} ä½æˆå“¡\n      </p>\n    </div>\n\n    <!-- Messages -->\n    <div ref=\"messageContainer\" class=\"flex-1 overflow-y-auto p-4 space-y-4\">\n      <div v-if=\"!currentConv\" class=\"flex items-center justify-center h-full\">\n        <p class=\"text-gray-500\">é¸æ“‡å°è©±é–‹å§‹èŠå¤©</p>\n      </div>\n\n      <div v-else>\n        <div\n          v-for=\"message in chatStore.currentMessages\"\n          :key=\"message.id\"\n          :class=\"[\n            'flex',\n            message.senderId === authStore.userId\n              ? 'justify-end'\n              : 'justify-start',\n          ]\"\n        >\n          <div\n            :class=\"[\n              'max-w-md',\n              message.senderId === authStore.userId\n                ? 'items-end'\n                : 'items-start',\n            ]\"\n          >\n            <!-- Sender name for group chats -->\n            <p\n              v-if=\"\n                currentConv.type === 'group' &&\n                message.senderId !== authStore.userId\n              \"\n              class=\"text-xs text-gray-500 mb-1 px-2\"\n            >\n              {{ message.senderName }}\n            </p>\n\n            <!-- Message bubble -->\n            <div\n              :class=\"[\n                'rounded-lg px-4 py-2 break-words',\n                message.senderId === authStore.userId\n                  ? 'bg-green-600 text-white'\n                  : 'bg-white text-gray-800 border border-gray-300',\n              ]\"\n            >\n              <!-- Image message -->\n              <img\n                v-if=\"message.type === 'image'\"\n                :src=\"message.content\"\n                alt=\"Image\"\n                class=\"max-w-xs rounded\"\n              />\n              <!-- Text message -->\n              <p v-else>{{ message.content }}</p>\n            </div>\n\n            <!-- Message info -->\n            <div\n              :class=\"[\n                'flex items-center space-x-2 mt-1 text-xs text-gray-500',\n                message.senderId === authStore.userId\n                  ? 'justify-end'\n                  : 'justify-start',\n              ]\"\n            >\n              <span>{{ formatTime(message.timestamp) }}</span>\n              <span v-if=\"message.senderId === authStore.userId\">\n                <span v-if=\"message.status === 'sent'\">âœ“</span>\n                <span v-else-if=\"message.status === 'delivered'\">âœ“âœ“</span>\n                <span\n                  v-else-if=\"message.status === 'read'\"\n                  class=\"text-green-600\"\n                  >âœ“âœ“</span\n                >\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <!-- Typing indicator -->\n        <div\n          v-if=\"chatStore.currentTypingUsers.length > 0\"\n          class=\"flex justify-start\"\n        >\n          <div class=\"bg-gray-300 rounded-lg px-4 py-2\">\n            <div class=\"flex space-x-1\">\n              <div\n                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n              ></div>\n              <div\n                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n                style=\"animation-delay: 0.1s\"\n              ></div>\n              <div\n                class=\"w-2 h-2 bg-gray-600 rounded-full animate-bounce\"\n                style=\"animation-delay: 0.2s\"\n              ></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <!-- Message Input -->\n    <div v-if=\"currentConv\" class=\"p-4 bg-white border-t border-gray-300\">\n      <div class=\"flex items-center space-x-2\">\n        <input\n          type=\"file\"\n          ref=\"fileInput\"\n          accept=\"image/*\"\n          class=\"hidden\"\n          @change=\"handleImageSelect\"\n        />\n        <button\n          @click=\"selectImage\"\n          class=\"p-2 text-gray-600 hover:bg-gray-100 rounded-lg\"\n          title=\"ä¸Šå‚³åœ–ç‰‡\"\n        >\n          ğŸ“\n        </button>\n        <input\n          v-model=\"messageInput\"\n          @keypress.enter=\"sendMessage\"\n          @input=\"handleTyping\"\n          type=\"text\"\n          placeholder=\"è¼¸å…¥è¨Šæ¯...\"\n          class=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n        />\n        <button\n          @click=\"sendMessage\"\n          class=\"px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-blue-700 font-semibold\"\n        >\n          ç™¼é€\n        </button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, watch, nextTick } from \"vue\";\nimport { useAuthStore } from \"../stores/auth\";\nimport { useChatStore } from \"../stores/chat\";\nimport { useChatSocket } from \"../composables/useChatSocket\";\n\nconst authStore = useAuthStore();\nconst chatStore = useChatStore();\nconst { sendMessage: socketSendMessage, sendTyping } = useChatSocket();\n\nconst messageInput = ref(\"\");\nconst fileInput = ref<HTMLInputElement | null>(null);\nconst messageContainer = ref<HTMLElement | null>(null);\nlet typingTimeout: number | null = null;\n\nconst currentConv = computed(() => {\n  return chatStore.conversations.find(\n    (c) => c.id === chatStore.currentConversationId\n  );\n});\n\n// Auto scroll to bottom when new messages arrive\nwatch(\n  () => chatStore.currentMessages.length,\n  async () => {\n    await nextTick();\n    if (messageContainer.value) {\n      messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n    }\n  }\n);\n\n// Auto scroll when conversation changes\nwatch(\n  () => chatStore.currentConversationId,\n  async () => {\n    await nextTick();\n    if (messageContainer.value) {\n      messageContainer.value.scrollTop = messageContainer.value.scrollHeight;\n    }\n  }\n);\n\nfunction sendMessage() {\n  if (!messageInput.value.trim() || !currentConv.value) return;\n\n  const recipientId =\n    currentConv.value.type === \"dm\" ? currentConv.value.recipientId : undefined;\n  const groupId =\n    currentConv.value.type === \"group\" ? currentConv.value.id : undefined;\n\n  socketSendMessage(recipientId, groupId, messageInput.value, \"text\");\n  messageInput.value = \"\";\n\n  // Stop typing indicator\n  sendTyping(recipientId, groupId, false);\n}\n\nfunction handleTyping() {\n  if (!currentConv.value) return;\n\n  const recipientId =\n    currentConv.value.type === \"dm\" ? currentConv.value.recipientId : undefined;\n  const groupId =\n    currentConv.value.type === \"group\" ? currentConv.value.id : undefined;\n\n  // Send typing started\n  sendTyping(recipientId, groupId, true);\n\n  // Clear previous timeout\n  if (typingTimeout) {\n    clearTimeout(typingTimeout);\n  }\n\n  // Send typing stopped after 2 seconds of inactivity\n  typingTimeout = window.setTimeout(() => {\n    sendTyping(recipientId, groupId, false);\n  }, 2000);\n}\n\nfunction selectImage() {\n  fileInput.value?.click();\n}\n\nfunction handleImageSelect(event: Event) {\n  const target = event.target as HTMLInputElement;\n  const file = target.files?.[0];\n  if (!file || !currentConv.value) return;\n\n  const reader = new FileReader();\n  reader.onload = (e) => {\n    const base64 = e.target?.result as string;\n\n    const recipientId =\n      currentConv.value!.type === \"dm\"\n        ? currentConv.value!.recipientId\n        : undefined;\n    const groupId =\n      currentConv.value!.type === \"group\" ? currentConv.value!.id : undefined;\n\n    socketSendMessage(recipientId, groupId, base64, \"image\");\n  };\n  reader.readAsDataURL(file);\n\n  // Reset file input\n  if (fileInput.value) {\n    fileInput.value.value = \"\";\n  }\n}\n\nfunction formatTime(timestamp: number): string {\n  const date = new Date(timestamp);\n  return date.toLocaleTimeString(\"zh-TW\", {\n    hour: \"2-digit\",\n    minute: \"2-digit\",\n  });\n}\n</script>\n"
        }
    ]
}