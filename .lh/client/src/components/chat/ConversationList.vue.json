{
    "sourceFile": "client/src/components/chat/ConversationList.vue",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763733773722,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763733773722,
            "name": "Commit-0",
            "content": "<template>\n  <div class=\"w-80 bg-stone-100 border-r border-stone-300 flex flex-col h-full\">\n    <!-- Header -->\n    <div\n      class=\"p-4 bg-white border-b border-stone-300 flex items-center justify-between\"\n    >\n      <button\n        @click=\"showCreateGroup = true\"\n        class=\"px-3 py-1 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 text-sm\"\n      >\n        建立群組\n      </button>\n    </div>\n\n    <!-- Conversation List -->\n    <div class=\"flex-1 overflow-y-auto\">\n      <div\n        v-for=\"conv in chatStore.conversations\"\n        :key=\"conv.id\"\n        @click=\"selectConversation(conv.id)\"\n        :class=\"[\n          'p-4 border-b border-stone-200 cursor-pointer hover:bg-stone-200 transition-colors',\n          chatStore.currentConversationId === conv.id\n            ? 'bg-emerald-50'\n            : 'bg-white',\n        ]\"\n      >\n        <div class=\"flex justify-between items-start mb-1\">\n          <span class=\"font-semibold text-stone-800\">{{ conv.name }}</span>\n          <span v-if=\"conv.lastMessage\" class=\"text-xs text-stone-500\">\n            {{ formatTime(conv.lastMessage.timestamp) }}\n          </span>\n        </div>\n        <div class=\"flex justify-between items-center\">\n          <p class=\"text-sm text-stone-600 truncate flex-1\">\n            {{ conv.lastMessage?.content || \"尚無訊息\" }}\n          </p>\n          <span\n            v-if=\"conv.unreadCount > 0\"\n            class=\"ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-0.5\"\n          >\n            {{ conv.unreadCount }}\n          </span>\n        </div>\n      </div>\n    </div>\n\n    <!-- Create Group Modal -->\n    <div\n      v-if=\"showCreateGroup\"\n      class=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\"\n      @click.self=\"showCreateGroup = false\"\n    >\n      <div class=\"bg-white rounded-lg p-6 w-96\">\n        <h3 class=\"text-xl font-bold mb-4\">建立群組</h3>\n        <input\n          v-model=\"groupName\"\n          type=\"text\"\n          placeholder=\"群組名稱\"\n          class=\"w-full px-4 py-2 rounded-lg mb-4\"\n        />\n        <div class=\"mb-4 max-h-60 overflow-y-auto\">\n          <p class=\"text-sm text-stone-600 mb-2\">選擇成員:</p>\n          <label\n            v-for=\"user in availableUsers\"\n            :key=\"user.id\"\n            class=\"flex items-center p-2 hover:bg-stone-100 rounded cursor-pointer\"\n          >\n            <input\n              type=\"checkbox\"\n              :value=\"user.id\"\n              v-model=\"selectedMembers\"\n              class=\"mr-2\"\n            />\n            <span>{{ user.username }}</span>\n            <span v-if=\"user.isOnline\" class=\"ml-2 text-emerald-600 text-sm\"\n              >● 在線</span\n            >\n          </label>\n        </div>\n        <div class=\"flex space-x-2\">\n          <button\n            @click=\"handleCreateGroup\"\n            class=\"flex-1 bg-emerald-600 text-white py-2 rounded-lg hover:bg-emerald-700\"\n          >\n            建立\n          </button>\n          <button\n            @click=\"showCreateGroup = false\"\n            class=\"flex-1 bg-stone-300 text-stone-700 py-2 rounded-lg hover:bg-stone-400\"\n          >\n            取消\n          </button>\n        </div>\n      </div>\n    </div>\n\n    <!-- Footer -->\n    <div class=\"flex flex-row\">\n      <div class=\"w-14 h-14 rounded-full bg-stone-300 relative\">\n        <p class=\"absolute bottom-2 right-2 text-sm text-emerald-600\">●</p>\n      </div>\n      <div>\n        <h2 class=\"text-md font-bold text-stone-800\">\n          {{ authStore.username }}\n        </h2>\n\n        <p>線上</p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed } from \"vue\";\nimport { useAuthStore } from \"../../stores/auth\";\nimport { useChatStore } from \"../../stores/chat\";\nimport { useChatSocket } from \"../../composables/useChatSocket\";\n\nconst authStore = useAuthStore();\nconst chatStore = useChatStore();\nconst { createGroup } = useChatSocket();\n\nconst showCreateGroup = ref(false);\nconst groupName = ref(\"\");\nconst selectedMembers = ref<string[]>([]);\n\nconst availableUsers = computed(() => {\n  return chatStore.users.filter((u) => u.id !== authStore.userId);\n});\n\nfunction selectConversation(conversationId: string) {\n  chatStore.setCurrentConversation(conversationId);\n}\n\nfunction formatTime(timestamp: number): string {\n  const date = new Date(timestamp);\n  const now = new Date();\n  const diff = now.getTime() - date.getTime();\n\n  if (diff < 60000) return \"剛剛\";\n  if (diff < 3600000) return `${Math.floor(diff / 60000)}分鐘前`;\n  if (diff < 86400000)\n    return date.toLocaleTimeString(\"zh-TW\", {\n      hour: \"2-digit\",\n      minute: \"2-digit\",\n    });\n  return date.toLocaleDateString(\"zh-TW\");\n}\n\nfunction handleCreateGroup() {\n  if (groupName.value && selectedMembers.value.length > 0) {\n    createGroup(groupName.value, selectedMembers.value);\n    showCreateGroup.value = false;\n    groupName.value = \"\";\n    selectedMembers.value = [];\n  }\n}\n</script>\n"
        }
    ]
}